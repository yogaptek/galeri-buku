<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tampilan Skor & American Literature</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background-color: white;
      font-family: Arial, sans-serif;
      color: white;
    }

    #skorDisplay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 80vh;
      font-weight: bold;
      visibility: hidden;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      z-index: 2;
    }

    #starter {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      z-index: 9999;
      cursor: pointer;
    }

    #ornamenContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .ornamen {
      position: absolute;
      font-size: 24px;
      animation: jatuh 2s linear forwards;
    }

    @keyframes jatuh {
      0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
      100% { transform: translate(var(--x), 100vh) rotate(var(--r)); opacity: 0; }
    }

    #glowLayer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.6) 0%, transparent 70%);
      animation: glowBurst 1s ease-out forwards;
    }

    @keyframes glowBurst {
      0% {
        opacity: 0.8;
        transform: scale(0.5);
        filter: blur(20px);
        background: radial-gradient(circle at center, red, orange, yellow, green, cyan, blue, violet);
      }
      100% {
        opacity: 0;
        transform: scale(2);
        filter: blur(60px);
      }
    }

    @keyframes shake {
      0% { transform: translate(0, 0); }
      20% { transform: translate(-5px, 0); }
      40% { transform: translate(5px, 0); }
      60% { transform: translate(-5px, 0); }
      80% { transform: translate(5px, 0); }
      100% { transform: translate(0, 0); }
    }

    .shake {
      animation: shake 0.6s ease-in-out;
    }

    #instructions,
    #shuffleBtn,
    #categoryContainer {
      display: none;
    }

    #instructions {
      position: absolute;
      top: 20px;
      left: 20px;
      max-width: 400px;
      background: #fff;
      color: #000;
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.5;
      z-index: 10000;
    }

    #shuffleBtn {
      position: absolute;
      top: 200px;
      left: 20px;
      padding: 10px 20px;
      font-size: 14px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10000;
    }

    #categoryContainer {
      position: absolute;
      top: 260px;
      left: 20px;
      max-width: 400px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      z-index: 10000;
    }

    .category {
      font-size: 0.9em;
      font-weight: bold;
      padding: 12px;
      border-radius: 10px;
      color: #fff;
      min-width: 120px;
      max-width: 180px;
      word-wrap: break-word;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

  <div id="skorDisplay"></div>
  <div id="starter" onclick="unlockAudio()">Start</div>
  <div id="ornamenContainer"></div>
  <div id="glowLayer"></div>

  <div id="instructions">
    <strong>Survey of American Literature</strong><br><br>
    Klik tombol <strong>Randomize Category</strong> untuk menampilkan 9 kategori acak.<br>
    Pilih satu kategori dan siapkan jawaban untuk 3 pertanyaan analisis.<br>
    Jika perlu, kamu boleh memilih satu kategori tambahan tanpa klik ulang.
  </div>

  <button id="shuffleBtn">Randomize Category</button>
  <div id="categoryContainer"></div>

  <audio id="niceTry" src="https://yogaptek.github.io/suara/drum-roll-and-cymbals.mp3" preload="auto"></audio>
  <audio id="notBad" src="https://assets.mixkit.co/sfx/download/mixkit-game-notification-wave-2314.mp3" preload="auto"></audio>
  <audio id="goodJob" src="https://assets.mixkit.co/sfx/download/mixkit-achievement-bell-600.mp3" preload="auto"></audio>
  <audio id="applause" src="https://assets.mixkit.co/sfx/download/mixkit-small-crowd-applause-503.mp3" preload="auto"></audio>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyBiS9DczFWbLjb4wX-gnoTRd47qSwM4Z_I",
      authDomain: "assignment-60132.firebaseapp.com",
      databaseURL: "https://assignment-60132-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "assignment-60132",
      storageBucket: "assignment-60132.appspot.com",
      messagingSenderId: "469676760673",
      appId: "1:469676760673:web:f95637fe7beb92740f5420"
    };

    firebase.initializeApp(firebaseConfig);

    const skorDisplay = document.getElementById('skorDisplay');
    const starter = document.getElementById('starter');
    const ornamenContainer = document.getElementById('ornamenContainer');
    const glowLayer = document.getElementById('glowLayer');
    const niceTry = document.getElementById('niceTry');
    const notBad = document.getElementById('notBad');
    const goodJob = document.getElementById('goodJob');
    const applause = document.getElementById('applause');

    let audioUnlocked = false;

    function unlockAudio() {
      starter.style.display = 'none';
      [niceTry, notBad, goodJob, applause].forEach(audio => {
        audio.play().catch(() => {});
        audio.pause();
        audio.currentTime = 0;
      });
      audioUnlocked = true;

      document.getElementById('instructions').style.display = 'block';
      document.getElementById('shuffleBtn').style.display = 'inline-block';
      document.getElementById('categoryContainer').style.display = 'flex';
    }

    function getColorBySkor(skor) {
      if (skor >= 0 && skor <= 29) return '#990000';
      if (skor >= 30 && skor <= 59) return '#ff6600';
      if (skor >= 60 && skor <= 79) return '#ffcc00';
      if (skor >= 80 && skor <= 100) return '#00cc66';
      return '#660099';
    }

    function playFeedbackSound(skor) {
      if (!audioUnlocked) return;
      [niceTry, notBad, goodJob, applause].forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
      });

      if (skor >= 0 && skor <= 40
                  niceTry.play();
      } else if (skor >= 41 && skor <= 60) {
        notBad.play();
      } else if (skor >= 61 && skor <= 79) {
        goodJob.play();
      } else if (skor >= 80 && skor <= 100) {
        applause.play();
      }
    }

    function tampilkanOrnamen() {
      const simbol = ['ðŸŽ‰', 'âœ¨', 'â­', 'ðŸ’¥', 'ðŸŽˆ', 'ðŸŒŸ'];
      for (let i = 0; i < 30; i++) {
        const ornamen = document.createElement('div');
        ornamen.className = 'ornamen';
        ornamen.textContent = simbol[Math.floor(Math.random() * simbol.length)];

        const startX = Math.random() * 100;
        const offsetX = (Math.random() - 0.5) * 200;
        const rotasi = Math.random() * 720 - 360;

        ornamen.style.left = `${startX}vw`;
        ornamen.style.top = '-50px';
        ornamen.style.fontSize = `${Math.random() * 20 + 20}px`;
        ornamen.style.setProperty('--x', `${offsetX}px`);
        ornamen.style.setProperty('--r', `${rotasi}deg`);

        ornamenContainer.appendChild(ornamen);
        setTimeout(() => ornamen.remove(), 2000);
      }
    }

    function tampilkanGlow() {
      glowLayer.style.animation = 'none';
      void glowLayer.offsetWidth;
      glowLayer.style.animation = 'glowBurst 1s ease-out forwards';
    }

    firebase.database().ref('trigger').on('value', function(snapshot) {
      const val = snapshot.val();
      console.log('ðŸ“¡ Data diterima:', val);

      if (val && typeof val === 'object' && val.label) {
        const skor = parseInt(val.skor);
        const warna = getColorBySkor(skor);

        document.body.style.backgroundColor = warna;
        document.documentElement.style.backgroundColor = warna;

        skorDisplay.textContent = val.label;
        skorDisplay.style.visibility = 'visible';

        playFeedbackSound(skor);
        tampilkanOrnamen();
        tampilkanGlow();

        // Efek getar kategori
        document.querySelectorAll('.category').forEach(cat => {
          cat.classList.add('shake');
        });
        setTimeout(() => {
          document.querySelectorAll('.category').forEach(cat => {
            cat.classList.remove('shake');
          });
        }, 700);

        setTimeout(() => {
          skorDisplay.style.visibility = 'hidden';
          skorDisplay.textContent = '';
          document.body.style.backgroundColor = 'white';
          document.documentElement.style.backgroundColor = 'white';
          firebase.database().ref('trigger').set('idle');
        }, 3000);
      }
    });

    const americanCategories = [
      "Native American Literature", "Realism", "Modernism", "Naturalism", "Romanticism",
      "Declaration of Independence", "Savages", "Transcendentalism", "Slave Narrative", "Colonial Period",
      "Puritanism", "John Smith", "John Winthrop", "Olaudah Equiano", "Melting Pot and Salad Bowl",
      "Self Reliance", "The Cask of Amontillado", "Writing Style", "Local Color", "The Black Minister's Veil",
      "Afro American Voices in Modern Era", "Enlightenment", "What We Talk About When We Talk about Love",
      "Richard Wright", "Langston Hughes", "American Literature in General", "American Authors",
      "Present your Intellectual Diary in 3 minutes", "Random Question with 80pts", "Ask a question 30pts"
    ];

    const colors = [
      "#e74c3c", "#3498db", "#2ecc71", "#9b59b6", "#f39c12",
      "#1abc9c", "#e67e22", "#34495e", "#d35400", "#7f8c8d",
      "#16a085", "#c0392b", "#2980b9", "#8e44ad", "#27ae60"
    ];

    let clickCount = 0;
    const maxClicks = 5;

    const shuffleBtn = document.getElementById("shuffleBtn");
    const container = document.getElementById("categoryContainer");

    function shuffleAndDisplay() {
      container.innerHTML = "";
      const shuffled = americanCategories.sort(() => 0.5 - Math.random()).slice(0, 9);
      shuffled.forEach((cat, index) => {
        const div = document.createElement("div");
        div.className = "category";
        div.textContent = cat;
        div.style.backgroundColor = colors[index % colors.length];
        container.appendChild(div);
      });

      clickCount++;
      if (clickCount >= maxClicks) {
        shuffleBtn.disabled = true;
      }
    }

    shuffleBtn.addEventListener("click", shuffleAndDisplay);
  </script>

</body>
</html>
